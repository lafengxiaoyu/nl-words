# 学习统计功能测试指南

本文档说明如何测试新实现的学习统计功能。

## 前置条件

1. **数据库迁移**
   - 确保已执行 `DATABASE_MIGRATION.md` 中的 SQL 脚本
   - 在 Supabase Dashboard 中验证 `user_progress` 表已包含新字段

2. **环境变量**
   - 确保 `.env` 文件包含 Supabase 配置（可选，本地模式也可测试）

## 测试步骤

### 1. 启动应用

```bash
cd web
npm run dev
```

应用将在 `http://localhost:5173` 启动。

### 2. 测试查看统计

**测试场景：** 自动记录单词查看次数

1. 打开应用
2. 浏览不同的单词（点击"下一个"或"上一个"）
3. 打开详情面板（点击"显示详情"）
4. 查看"学习统计"部分
5. **预期结果：**
   - `viewCount` 应该随着每次查看单词而增加
   - `lastViewedAt` 应该显示最后查看的时间

### 3. 测试掌握统计

**测试场景：** 记录标记为掌握/未掌握的次数

1. 选择一个单词
2. 点击"标记掌握"按钮
3. 打开详情面板查看统计
4. **预期结果：**
   - `masteredCount` 应该增加 1
   - `mastered` 状态应该变为 `true`

5. 再次点击"取消掌握"按钮
6. **预期结果：**
   - `unmasteredCount` 应该增加 1
   - `mastered` 状态应该变为 `false`

### 4. 测试滑动标记（移动端）

**测试场景：** 使用滑动手势标记掌握状态

1. 在移动设备或浏览器开发者工具的移动模式下
2. 向右滑动单词卡片（80-200px）
3. **预期结果：**
   - 如果单词未掌握，应该标记为已掌握
   - `masteredCount` 应该增加
   - 显示"✅ 已掌握"反馈

4. 向左滑动单词卡片（80-200px）
5. **预期结果：**
   - 如果单词已掌握，应该标记为未掌握
   - `unmasteredCount` 应该增加
   - 显示"❌ 未掌握"反馈

### 5. 测试数据持久化

**测试场景：** 验证统计数据是否正确保存

#### 本地模式（未登录）

1. 查看几个单词并标记一些为掌握
2. 刷新页面
3. **预期结果：**
   - 统计数据应该从 localStorage 恢复
   - 查看次数和掌握次数应该保持不变

#### 云端模式（已登录）

1. 登录账户
2. 查看几个单词并标记一些为掌握
3. 等待同步完成（查看同步状态指示器）
4. 在另一个设备/浏览器中登录同一账户
5. **预期结果：**
   - 统计数据应该从 Supabase 同步
   - 查看次数和掌握次数应该一致

### 6. 测试测试功能接口（预留）

**测试场景：** 验证测试结果记录功能

虽然测试功能尚未实现，但可以通过控制台测试接口：

```javascript
// 在浏览器控制台中
// 假设当前单词 ID 是 1
recordTestResult(1, true)  // 记录正确答案
recordTestResult(1, false) // 记录错误答案
```

**预期结果：**
- `testCount` 应该增加
- `testCorrectCount` 或 `testWrongCount` 应该相应增加
- `lastTestedAt` 应该更新

### 7. 测试统计显示

**测试场景：** 验证统计信息在 UI 中正确显示

1. 打开详情面板
2. 查看"学习统计"部分
3. **预期结果：**
   - 应该显示所有统计字段
   - 如果有测试记录，应该显示正确率
   - 时间应该以本地格式显示

## 验证数据库

### 在 Supabase Dashboard 中验证

1. 登录 Supabase Dashboard
2. 进入 Table Editor
3. 查看 `user_progress` 表
4. **验证字段：**
   - `view_count` 应该 > 0（如果查看过单词）
   - `mastered_count` 应该 > 0（如果标记过掌握）
   - `unmastered_count` 应该 > 0（如果取消过掌握）
   - `last_viewed_at` 应该有时间戳

### SQL 查询示例

```sql
-- 查看用户的学习统计
SELECT 
  word_id,
  view_count,
  mastered_count,
  unmastered_count,
  test_count,
  test_correct_count,
  test_wrong_count,
  last_viewed_at,
  last_tested_at
FROM user_progress
WHERE user_id = 'your-user-id'
ORDER BY view_count DESC;
```

## 常见问题排查

### 问题 1：统计数据不更新

**可能原因：**
- 数据库迁移未执行
- Supabase 配置错误
- 网络连接问题

**解决方法：**
1. 检查浏览器控制台是否有错误
2. 验证数据库表结构
3. 检查 Supabase 环境变量

### 问题 2：统计数据丢失

**可能原因：**
- localStorage 被清除
- 数据库同步失败

**解决方法：**
1. 检查 localStorage 中是否有数据
2. 查看 Supabase 数据库是否有记录
3. 检查同步状态指示器

### 问题 3：统计显示不正确

**可能原因：**
- 数据格式问题
- 时区问题

**解决方法：**
1. 检查浏览器控制台
2. 验证数据格式
3. 检查时间格式化

## 测试检查清单

- [ ] 查看统计自动记录
- [ ] 掌握统计正确记录
- [ ] 滑动手势正常工作
- [ ] 本地数据持久化
- [ ] 云端数据同步
- [ ] 统计信息正确显示
- [ ] 数据库字段正确更新
- [ ] 时间戳正确记录
- [ ] 测试接口可用（预留）

## 性能测试

### 大量数据测试

1. 创建大量单词（100+）
2. 快速浏览所有单词
3. **预期结果：**
   - 应用应该保持流畅
   - 统计数据应该正确记录
   - 同步不应该阻塞 UI

## 浏览器兼容性

测试以下浏览器：
- [ ] Chrome/Edge（最新版）
- [ ] Firefox（最新版）
- [ ] Safari（最新版）
- [ ] 移动浏览器（iOS Safari, Chrome Mobile）

## 报告问题

如果发现问题，请记录：
1. 浏览器和版本
2. 操作步骤
3. 预期结果
4. 实际结果
5. 控制台错误信息
6. 网络请求详情（如果相关）

